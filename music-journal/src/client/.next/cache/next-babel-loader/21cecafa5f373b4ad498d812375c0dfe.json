{"ast":null,"code":"const Cookies = require('cookies');\n\nconst crypto = require('crypto');\n\nconst SpotifyWebApi = require('spotify-web-api-node');\n\nconst Spotify = new SpotifyWebApi({\n  clientId: process.env.SPOTIFY_CLIENT_ID,\n  clientSecret: process.env.SPOTIFY_CLIENT_SECRET,\n  redirectUri: process.env.AUTH_REDIRECT_URL\n});\nconst OAUTH_SCOPES = ['user-read-email', 'user-read-recently-played'];\nexport default function handler(req, res) {\n  const cookies = new Cookies(req, res);\n  const state = req.cookies.state || crypto.randomBytes(20).toString('hex');\n  cookies.set('verificationState', state.toString());\n  cookies.set('maxAge', 3600000);\n  cookies.set('secure', true);\n  cookies.set('httpOnly', true);\n  const authorizeURL = Spotify.createAuthorizeURL(OAUTH_SCOPES, state.toString());\n  res.writeHead(301, {\n    Location: authorizeURL\n  });\n  res.end();\n}","map":{"version":3,"sources":["/mnt/c/Users/ajtwi/git/MusicJournal/music-journal/pages/api/spotify-auth.js"],"names":["Cookies","require","crypto","SpotifyWebApi","Spotify","clientId","process","env","SPOTIFY_CLIENT_ID","clientSecret","SPOTIFY_CLIENT_SECRET","redirectUri","AUTH_REDIRECT_URL","OAUTH_SCOPES","handler","req","res","cookies","state","randomBytes","toString","set","authorizeURL","createAuthorizeURL","writeHead","Location","end"],"mappings":"AAAA,MAAMA,OAAO,GAAGC,OAAO,CAAC,SAAD,CAAvB;;AACA,MAAMC,MAAM,GAAGD,OAAO,CAAC,QAAD,CAAtB;;AACA,MAAME,aAAa,GAAGF,OAAO,CAAC,sBAAD,CAA7B;;AAEA,MAAMG,OAAO,GAAG,IAAID,aAAJ,CAAkB;AAChCE,EAAAA,QAAQ,EAAEC,OAAO,CAACC,GAAR,CAAYC,iBADU;AAEhCC,EAAAA,YAAY,EAAEH,OAAO,CAACC,GAAR,CAAYG,qBAFM;AAGhCC,EAAAA,WAAW,EAAEL,OAAO,CAACC,GAAR,CAAYK;AAHO,CAAlB,CAAhB;AAKA,MAAMC,YAAY,GAAG,CAAC,iBAAD,EAAoB,2BAApB,CAArB;AAEA,eAAe,SAASC,OAAT,CAAiBC,GAAjB,EAAsBC,GAAtB,EAA2B;AACxC,QAAMC,OAAO,GAAG,IAAIjB,OAAJ,CAAYe,GAAZ,EAAiBC,GAAjB,CAAhB;AACA,QAAME,KAAK,GAAGH,GAAG,CAACE,OAAJ,CAAYC,KAAZ,IAAqBhB,MAAM,CAACiB,WAAP,CAAmB,EAAnB,EAAuBC,QAAvB,CAAgC,KAAhC,CAAnC;AACAH,EAAAA,OAAO,CAACI,GAAR,CAAY,mBAAZ,EAAiCH,KAAK,CAACE,QAAN,EAAjC;AACAH,EAAAA,OAAO,CAACI,GAAR,CAAY,QAAZ,EAAsB,OAAtB;AACAJ,EAAAA,OAAO,CAACI,GAAR,CAAY,QAAZ,EAAsB,IAAtB;AACAJ,EAAAA,OAAO,CAACI,GAAR,CAAY,UAAZ,EAAwB,IAAxB;AACA,QAAMC,YAAY,GAAGlB,OAAO,CAACmB,kBAAR,CAA2BV,YAA3B,EAAyCK,KAAK,CAACE,QAAN,EAAzC,CAArB;AACAJ,EAAAA,GAAG,CAACQ,SAAJ,CAAc,GAAd,EAAmB;AACjBC,IAAAA,QAAQ,EAAEH;AADO,GAAnB;AAGAN,EAAAA,GAAG,CAACU,GAAJ;AACD","sourcesContent":["const Cookies = require('cookies');\nconst crypto = require('crypto');\nconst SpotifyWebApi = require('spotify-web-api-node');\n\nconst Spotify = new SpotifyWebApi({\n  clientId: process.env.SPOTIFY_CLIENT_ID,\n  clientSecret: process.env.SPOTIFY_CLIENT_SECRET,\n  redirectUri: process.env.AUTH_REDIRECT_URL,\n});\nconst OAUTH_SCOPES = ['user-read-email', 'user-read-recently-played'];\n\nexport default function handler(req, res) {\n  const cookies = new Cookies(req, res);\n  const state = req.cookies.state || crypto.randomBytes(20).toString('hex');\n  cookies.set('verificationState', state.toString());\n  cookies.set('maxAge', 3600000);\n  cookies.set('secure', true);\n  cookies.set('httpOnly', true);\n  const authorizeURL = Spotify.createAuthorizeURL(OAUTH_SCOPES, state.toString());\n  res.writeHead(301, {\n    Location: authorizeURL\n  });\n  res.end();\n}\n"]},"metadata":{},"sourceType":"module"}